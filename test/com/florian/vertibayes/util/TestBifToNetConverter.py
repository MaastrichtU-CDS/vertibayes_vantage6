import unittest

from com.florian.vertibayes.util import mapBif

biffSmall  =  "<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?><ProbModelXML formatVersion=\"0.2.0\">  <ProbNet type=\"BayesianNetwork\">    <DecisionCriteria>      <Criterion name=\"---\" unit=\"---\"/>    </DecisionCriteria>    <Properties/>    <Variables>      <Variable name=\"x3\" role=\"chance\" type=\"finiteStates\">        <States>          <State name=\"0\"/>          <State name=\"1\"/>        </States>      </Variable>      <Variable name=\"x1\" role=\"chance\" type=\"finiteStates\">        <States>          <State name=\"0\"/>          <State name=\"1\"/>        </States>      </Variable>      <Variable name=\"x2\" role=\"chance\" type=\"finiteStates\">        <States>          <State name=\"0\"/>          <State name=\"1\"/>        </States>      </Variable>    </Variables>    <Links>      <Link directed=\"true\">        <Variable name=\"x3\"/>        <Variable name=\"x1\"/>      </Link>      <Link directed=\"true\">        <Variable name=\"x3\"/>        <Variable name=\"x2\"/>      </Link>    </Links>    <Potentials>      <Potential role=\"conditionalProbability\" type=\"Table\">        <Variables>          <Variable name=\"x3\"/>        </Variables>        <Values>0.403009699030097 0.596990300969903</Values>      </Potential>      <Potential role=\"conditionalProbability\" type=\"Table\">        <Variables>          <Variable name=\"x1\"/>          <Variable name=\"x3\"/>        </Variables>        <Values>0.7500620193500372 0.24993798064996278 0.32046558365432926 0.6795344163456707</Values>      </Potential>      <Potential role=\"conditionalProbability\" type=\"Table\">        <Variables>          <Variable name=\"x2\"/>          <Variable name=\"x3\"/>        </Variables>        <Values>0.9986355742991814 0.0013644257008186553 0.16069335119745437 0.8393066488025457</Values>      </Potential>    </Potentials>  </ProbNet>  <InferenceOptions>    <MulticriteriaOptions>      <SelectedAnalysisType>UNICRITERION</SelectedAnalysisType>      <Unicriterion>        <Scales>          <Scale Criterion=\"---\" Value=\"1.0\"/>        </Scales>      </Unicriterion>      <CostEffectiveness>        <Scales>          <Scale Criterion=\"---\" Value=\"1.0\"/>        </Scales>        <CE_Criteria>          <CE_Criterion Criterion=\"---\" Value=\"Cost\"/>        </CE_Criteria>      </CostEffectiveness>    </MulticriteriaOptions>  </InferenceOptions></ProbModelXML>"
netSmall = "net{} node x3 { states = ( \"0\" \"1\" );} node x1 { states = ( \"0\" \"1\" );} node x2 { states = ( \"0\" \"1\" );}potential ( x3 ) {  data = (0.403009699030097 0.596990300969903) ;}potential ( x1 | x3 ) {  data = ((0.7500620193500372 0.24993798064996278)(0.32046558365432926 0.6795344163456707)) ;}potential ( x2 | x3 ) {  data = ((0.9986355742991814 0.0013644257008186553)(0.16069335119745437 0.8393066488025457)) ;}"

biffSurvey ="<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?><ProbModelXML formatVersion=\"0.2.0\">  <ProbNet type=\"BayesianNetwork\">    <DecisionCriteria>      <Criterion name=\"---\" unit=\"---\"/>    </DecisionCriteria>    <Properties/>    <Variables>      <Variable name=\"A\" role=\"chance\" type=\"finiteStates\">        <States>          <State name=\"young\"/>          <State name=\"adult\"/>		  <State name=\"old\"/>        </States>      </Variable>      <Variable name=\"S\" role=\"chance\" type=\"finiteStates\">        <States>          <State name=\"M\"/>          <State name=\"F\"/>        </States>      </Variable>      <Variable name=\"E\" role=\"chance\" type=\"finiteStates\">        <States>          <State name=\"high\"/>          <State name=\"uni\"/>        </States>      </Variable>	   <Variable name=\"O\" role=\"chance\" type=\"finiteStates\">        <States>          <State name=\"emp\"/>          <State name=\"self\"/>        </States>      </Variable>	   <Variable name=\"R\" role=\"chance\" type=\"finiteStates\">        <States>          <State name=\"small\"/>          <State name=\"big\"/>        </States>      </Variable>	   <Variable name=\"T\" role=\"chance\" type=\"finiteStates\">        <States>          <State name=\"car\"/>          <State name=\"train\"/>		  <State name=\"other\"/>        </States>      </Variable>    </Variables>    <Links>      <Link directed=\"true\">        <Variable name=\"A\"/>		<Variable name=\"E\"/>      </Link>	  <Link directed=\"true\">        <Variable name=\"S\"/>		<Variable name=\"E\"/>      </Link>      <Link directed=\"true\">        <Variable name=\"E\"/>        <Variable name=\"O\"/>      </Link>	   <Link directed=\"true\">        <Variable name=\"E\"/>        <Variable name=\"R\"/>      </Link>	   <Link directed=\"true\">        <Variable name=\"O\"/>        <Variable name=\"T\"/>      </Link>	   <Link directed=\"true\">        <Variable name=\"R\"/>        <Variable name=\"T\"/>      </Link>    </Links>    <Potentials>	<Potential role=\"conditionalProbability\" type=\"Table\">        <Variables>          <Variable name=\"A\"/>        </Variables>        <Values>0.3 0.5 0.2</Values>      </Potential>      <Potential role=\"conditionalProbability\" type=\"Table\">        <Variables>          <Variable name=\"S\"/>        </Variables>        <Values>0.6 0.4</Values>      </Potential>      <Potential role=\"conditionalProbability\" type=\"Table\">        <Variables>          <Variable name=\"E\"/>          <Variable name=\"A\"/>		  <Variable name=\"S\"/>        </Variables>        <Values>0.75 0.25 0.64 0.36 0.72 0.28 0.7 0.3 0.88 0.12 0.9 0.1</Values>      </Potential>      <Potential role=\"conditionalProbability\" type=\"Table\">        <Variables>          <Variable name=\"O\"/>          <Variable name=\"E\"/>        </Variables>        <Values>0.96 0.04 0.92 0.08</Values>      </Potential>	  <Potential role=\"conditionalProbability\" type=\"Table\">        <Variables>          <Variable name=\"R\"/>          <Variable name=\"E\"/>        </Variables>        <Values>0.25 0.75 0.2 0.8</Values>      </Potential>	  <Potential role=\"conditionalProbability\" type=\"Table\">        <Variables>          <Variable name=\"T\"/>          <Variable name=\"O\"/>		  <Variable name=\"R\"/>        </Variables>        <Values>0.48 0.42 0.10 0.58 0.24 0.18 0.56 0.36 0.08 0.70 0.21 0.09</Values>      </Potential>    </Potentials>  </ProbNet>  <InferenceOptions>    <MulticriteriaOptions>      <SelectedAnalysisType>UNICRITERION</SelectedAnalysisType>      <Unicriterion>        <Scales>          <Scale Criterion=\"---\" Value=\"1.0\"/>        </Scales>      </Unicriterion>      <CostEffectiveness>        <Scales>          <Scale Criterion=\"---\" Value=\"1.0\"/>        </Scales>        <CE_Criteria>          <CE_Criterion Criterion=\"---\" Value=\"Cost\"/>        </CE_Criteria>      </CostEffectiveness>    </MulticriteriaOptions>  </InferenceOptions></ProbModelXML>"
netSurvey = "net{} node A { states = ( \"young\" \"adult\" \"old\" );} node S { states = ( \"M\" \"F\" );} node E { states = ( \"high\" \"uni\" );} node O { states = ( \"emp\" \"self\" );} node R { states = ( \"small\" \"big\" );} node T { states = ( \"car\" \"train\" \"other\" );}potential ( A ) {  data = (0.3 0.5 0.2) ;}potential ( S ) {  data = (0.6 0.4) ;}potential ( E | A S ) {  data = (((0.75 0.25)(0.64 0.36))((0.72 0.28)(0.7 0.3))((0.88 0.12)(0.9 0.1))) ;}potential ( O | E ) {  data = ((0.96 0.04)(0.92 0.08)) ;}potential ( R | E ) {  data = ((0.25 0.75)(0.2 0.8)) ;}potential ( T | O R ) {  data = (((0.48 0.42 0.10)(0.58 0.24 0.18))((0.56 0.36 0.08)(0.70 0.21 0.09))) ;}"

bifDiscrete="<?xml version=\"1.0\" encoding=\"UTF-8\"?><ProbModelXML formatVersion=\"0.2.0\">  <ProbNet type=\"BayesianNetwork\">    <Comment showWhenOpeningNetwork=\"false\"><![CDATA[<<Double click to add/modify comment>>]]></Comment>    <DecisionCriteria>      <Criterion name=\"---\" unit=\"---\" />    </DecisionCriteria>    <Properties />    <Variables>      <Variable name=\"A\" type=\"discretized\" role=\"chance\">        <Coordinates x=\"432\" y=\"131\" />        <Unit />        <Precision>0.01</Precision>        <States>          <State name=\"absent\" />          <State name=\"present\" />        </States>        <Thresholds>          <Threshold value=\"0.0\" belongsTo=\"left\" />          <Threshold value=\"10.0\" belongsTo=\"right\" />          <Threshold value=\"20.0\" belongsTo=\"right\" />        </Thresholds>      </Variable>      <Variable name=\"B\" type=\"finiteStates\" role=\"chance\">        <Coordinates x=\"499\" y=\"93\" />        <States>          <State name=\"absent\" />          <State name=\"present\" />        </States>      </Variable>      <Variable name=\"C\" type=\"finiteStates\" role=\"chance\">        <Coordinates x=\"500\" y=\"165\" />        <States>          <State name=\"absent\" />          <State name=\"present\" />        </States>      </Variable>    </Variables>    <Links>      <Link directed=\"true\">        <Variable name=\"A\" />        <Variable name=\"C\" />      </Link>      <Link directed=\"true\">        <Variable name=\"B\" />        <Variable name=\"A\" />      </Link>    </Links>    <Potentials>      <Potential type=\"Table\" role=\"conditionalProbability\">        <Variables>          <Variable name=\"A\" />          <Variable name=\"B\" />        </Variables>        <Values>0.7 0.3 0.6 0.4</Values>      </Potential>      <Potential type=\"Table\" role=\"conditionalProbability\">        <Variables>          <Variable name=\"B\" />        </Variables>        <Values>0.4 0.6</Values>      </Potential>      <Potential type=\"Table\" role=\"conditionalProbability\">        <Variables>          <Variable name=\"C\" />          <Variable name=\"A\" />        </Variables>        <Values>0.9 0.1 0.8 0.2</Values>      </Potential>    </Potentials>  </ProbNet>  <InferenceOptions>    <MulticriteriaOptions>      <SelectedAnalysisType>UNICRITERION</SelectedAnalysisType>      <Unicriterion>        <Scales>          <Scale Criterion=\"---\" Value=\"1.0\" />        </Scales>      </Unicriterion>      <CostEffectiveness>        <Scales>          <Scale Criterion=\"---\" Value=\"1.0\" />        </Scales>        <CE_Criteria>          <CE_Criterion Criterion=\"---\" Value=\"Cost\" />        </CE_Criteria>      </CostEffectiveness>    </MulticriteriaOptions>  </InferenceOptions></ProbModelXML>"
netDiscrete="net{} node A { states = ( \"absent\" \"present\" );} node B { states = ( \"absent\" \"present\" );} node C { states = ( \"absent\" \"present\" );}potential ( A | B ) {  data = ((0.7 0.3)(0.6 0.4)) ;}potential ( B ) {  data = (0.4 0.6) ;}potential ( C | A ) {  data = ((0.9 0.1)(0.8 0.2)) ;}"

bifSomething = '<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<ProbModelXML formatVersion="0.2.0">\n  <ProbNet type="BayesianNetwork">\n    <DecisionCriteria>\n      <Criterion name="---" unit="---"/>\n    </DecisionCriteria>\n    <Properties/>\n    <Variables>\n      <Variable name="x1" role="chance" type="discretized">\n        <Unit/>\n        <Precision>0.01</Precision>\n        <States>\n          <State name="All;All"/>\n        </States>\n        <Thresholds>\n          <Threshold belongsTo="left" value="-Infinity"/>\n          <Threshold belongsTo="right" value="Infinity"/>\n        </Thresholds>\n      </Variable>\n      <Variable name="x2" role="chance" type="discretized">\n        <Unit/>\n        <Precision>0.01</Precision>\n        <States>\n          <State name="All;All"/>\n        </States>\n        <Thresholds>\n          <Threshold belongsTo="left" value="-Infinity"/>\n          <Threshold belongsTo="right" value="Infinity"/>\n        </Thresholds>\n      </Variable>\n      <Variable name="x3" role="chance" type="finiteStates">\n        <States>\n          <State name="0"/>\n          <State name="1"/>\n        </States>\n      </Variable>\n    </Variables>\n    <Links>\n      <Link directed="true">\n        <Variable name="x1"/>\n        <Variable name="x2"/>\n      </Link>\n      <Link directed="true">\n        <Variable name="x2"/>\n        <Variable name="x3"/>\n      </Link>\n      <Link directed="true">\n        <Variable name="x1"/>\n        <Variable name="x3"/>\n      </Link>\n    </Links>\n    <Potentials>\n      <Potential role="conditionalProbability" type="Table">\n        <Variables>\n          <Variable name="x1"/>\n        </Variables>\n        <Values>1.0</Values>\n      </Potential>\n      <Potential role="conditionalProbability" type="Table">\n        <Variables>\n          <Variable name="x2"/>\n          <Variable name="x1"/>\n        </Variables>\n        <Values>1.0</Values>\n      </Potential>\n      <Potential role="conditionalProbability" type="Table">\n        <Variables>\n          <Variable name="x3"/>\n          <Variable name="x2"/>\n          <Variable name="x1"/>\n        </Variables>\n        <Values>0.5050994900509949 0.4949005099490051</Values>\n      </Potential>\n    </Potentials>\n  </ProbNet>\n  <InferenceOptions>\n    <MulticriteriaOptions>\n      <SelectedAnalysisType>UNICRITERION</SelectedAnalysisType>\n      <Unicriterion>\n        <Scales>\n          <Scale Criterion="---" Value="1.0"/>\n        </Scales>\n      </Unicriterion>\n      <CostEffectiveness>\n        <Scales>\n          <Scale Criterion="---" Value="1.0"/>\n        </Scales>\n        <CE_Criteria>\n          <CE_Criterion Criterion="---" Value="Cost"/>\n        </CE_Criteria>\n      </CostEffectiveness>\n    </MulticriteriaOptions>\n  </InferenceOptions>\n</ProbModelXML>\n'

class Test(unittest.TestCase):
    def test_network(self):
        mapBif(bifSomething)
        self.assertEqual(mapBif(biffSmall), netSmall)
        self.assertEqual(mapBif(biffSurvey), netSurvey)
        self.assertEqual(mapBif(bifDiscrete), netDiscrete)







